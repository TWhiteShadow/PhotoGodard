{% extends '/admin/dashboard.html.twig' %}

{% block title %}Edit Category
{% endblock %}

{% block main_content %}
	<h1>Edit Category</h1>

	{{ include('admin/category/_form.html.twig') }}


    {# bottom bar of action buttons #}
	<div class="actionButtons flex flex-row my-6">
		<a href="{{ path('app_admin_category_index') }}" class="back-button">Revenir en arri√®re</a>

		{{ include('admin/category/_delete_form.html.twig') }}
	</div>



	<script>
		var newPhotosPrototype = document.querySelector('#category_newPhotos').dataset.prototype;

        // Remplacer __name__ par un nom unique
        var uniqueId = new Date().getTime(); // Utiliser un timestamp comme identifiant unique
        var newPhotosPrototypeModified = newPhotosPrototype.replace(/__name__/g, uniqueId);

        var tempDiv = document.createElement('div');
        tempDiv.innerHTML = newPhotosPrototypeModified;

        var newPhotoPrototypeElement = tempDiv.firstChild;

        document.querySelector(".newPhotosContainer").appendChild(newPhotoPrototypeElement);
		document.addEventListener('DOMContentLoaded', function() {
			const checkboxes = document.querySelectorAll('.favorite-picture');

			checkboxes.forEach(function(checkbox) {
				checkbox.addEventListener('change', function() {
					parent_id = checkbox.dataset.parentId;
					photo_id = checkbox.dataset.photoId;

					checkedCheckboxes = Array.from(checkboxes).filter(function(cb) {
						return cb.checked;
					});
					checkedCheckboxes.forEach(function(otherCheckbox) {
						if (otherCheckbox !== checkbox) {
							otherCheckbox.checked = false;
						}
					});
					
					// Determine the value to send in the AJAX request
					const dataToSend = {
						photoId: this.checked ? photo_id : null // Send photo_id if checked, otherwise send null
					};

					// Send an AJAX request to update favorite picture
					$.ajax({
						url: '/admin/category/' + parent_id + '/update/favorite', // Replace with your actual route
						type: 'POST',
						data: dataToSend
					});
				});
			});
		});

	</script>
{% endblock %}
